version: 2.1
orbs:
  nirmata: nirmata/nirmata-test@2.9.10
jobs:
  build:
    docker:
      - image: circleci/python
    steps:
      - checkout
      - nirmata/add_catalog_app_command:
          app_name: "circlecitest1"
          yaml_file: "nginx.yml"
          nirmata_server: "nirmata.io"
          catalog : "circlecitest"
      - nirmata/create_env_command:
          env_name: "circle-demo"
          cluster_name: "sam-test-conf"
          type: "large"
          nirmata_server: "nirmata.io"
      - nirmata/deploy_command:
          app_name: "circlecitest1"
          app_name_deploy: "circlecitest1"
          nirmata_server: "nirmata.io"
          env_name: "circle-demo"
          catalog : "circlecitest"
      - run:
          command: sleep 30
      - nirmata/delete_catalog_app_command:
          app_name: "circlecitest1"
          nirmata_server: "nirmata.io"
          catalog : "circlecitest"
      - nirmata/delete_deployed_app_command:
          app_name: "circlecitest1"
          nirmata_server: "nirmata.io"
          env_name: "circle-demo"
      - nirmata/delete_env_command:
          nirmata_server: "nirmata.example.com"
          env_name: "prod-dev"
          cluster_name: "dev"
